R.003150

----------

Name: GHW - Next helper - ADMINREPORT
Created by: George H Williams

----------

Group: -
     -

Created on: 2018-12-27 12:02:59
Modified on: 2018-12-27 15:48:12
Date last run: 2019-01-29 22:05:12

----------

Public: 0
Expiry: 300

----------



----------

SELECT
  adult_book.NEWSTUFF AS TEXT_TO_PASTE_TO_HOOTSUITE
FROM
  (SELECT
      Concat("Recently added fiction:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      (items.itype = "BOOK" OR
        items.itype = "NEWBOOK ") AND
      items.location = 'ADULT' AND
      items.ccode = 'FICTION' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) adult_book
UNION
SELECT
  adult_movie.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added DVD:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      (items.itype = 'MEDIA' OR
        items.itype = 'NEWMEDIA') AND
      items.location = 'ADULT' AND
      items.ccode = 'DVD' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) adult_movie
UNION
SELECT
  child_book.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added children's fiction:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      (items.itype = "BOOK" OR
        items.itype = 'NEWBOOK') AND
      items.location = 'CHILDRENS' AND
      items.ccode = 'FICTION' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) child_book
UNION
SELECT
  child_movie.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added children's DVD:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      (items.itype = 'MEDIA' OR
        items.itype = 'NEWMEDIA') AND
      items.location = 'CHILDRENS' AND
      items.ccode = 'DVD' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) child_movie
UNION
SELECT
  ya_book.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added young adult fiction:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      (items.itype = "BOOK" OR
        items.itype = 'NEWBOOK') AND
      items.location = 'YOUNGADULT' AND
      items.ccode = 'FICTION' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) ya_book
UNION
SELECT
  adult_audio.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added audiobook:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      items.itype = 'AUDIOBOOK' AND
      items.location = 'ADULT' AND
      items.ccode = 'BOOKONCD' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) adult_audio
UNION
SELECT
  child_audio.NEWSTUFF
FROM
  (SELECT
      Concat("Recently added children's audiobook:<br /><br />", Upper(Replace(Replace(Replace(Replace(biblio.title, " /", ""), " :", ""), " ;", ""), ".", "")), "<br /><br />https://nextkansas.org/cgi-bin/koha/opac-detail.pl?biblionumber=", biblio.biblionumber) AS NEWSTUFF,
      biblio.biblionumber
    FROM
      biblio
      JOIN items ON items.biblionumber = biblio.biblionumber
    WHERE
      items.barcode <> "" AND
      items.itype = 'AUDIOBOOK' AND
      items.location = 'CHILDRENS' AND
      items.ccode = 'BOOKONCD' AND
      (items.notforloan = 0 OR
        items.notforloan IS NULL) AND
      (items.damaged = 0 OR
        items.damaged IS NULL) AND
      (items.itemlost = 0 OR
        items.itemlost IS NULL) AND
      (items.withdrawn = 0 OR
        items.withdrawn IS NULL)
    ORDER BY
      biblio.biblionumber DESC
    LIMIT 1) child_audio
LIMIT 7



