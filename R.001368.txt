R.001368

----------

Name: Bib Search By Author sorted by title
Created by: Heather Braum

----------

Group: -
     -

Created on: 2012-05-02 00:38:22
Modified on: 2017-12-11 16:36:32
Date last run: 2017-12-11 16:36:41

----------

Public: 0
Expiry: 0

----------

Enhanced -- enter author name. For catalog cleanup

----------

SELECT
  Concat('<a href=\"/cgi-bin/koha/catalogue/detail.pl?biblionumber=', biblio.biblionumber, '\" target="_blank">LINK</a>') AS LINK,
  biblio.biblionumber,
  biblio.title,
  ExtractValue(biblio_metadata.metadata, '//datafield[@tag="245"]/subfield[@code>="h"]') AS MEDIUM,
  biblio.author,
  Count(items.itemnumber),
  ExtractValue(biblio_metadata.metadata, '//datafield[@tag="020"]/subfield[@code>="a"]') AS ISBNA,
  biblioitems.pages,
  biblioitems.size,
  biblioitems.publishercode,
  biblioitems.publicationyear,
  Concat('<a href=\"/cgi-bin/koha/catalogue/search.pl?idx=ti&q=', REPLACE(biblio.title, ' ','+') '&sort_by=title_az\" target="_blank">', biblio.title, '</a>') AS TITLE_SEARCH
FROM
  biblio
  JOIN items ON biblio.biblionumber = items.biblionumber
  LEFT JOIN biblioitems ON items.biblionumber = biblioitems.biblionumber
  JOIN biblio_metadata ON biblio_metadata.biblionumber = biblio.biblionumber
WHERE
  biblio.author LIKE Concat("%", <<author>>,"%") AND
  items.itype <> 'AUDIOBOOK'
GROUP BY
  biblio.biblionumber
HAVING
  Count(items.itemnumber) > 0
ORDER BY
  biblio.title,
  biblioitems.pages,
  biblioitems.publishercode
