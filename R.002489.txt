R.002489

----------

Name: Possible Patrons to Purge
Created by: Heather Braum

----------

Group: Patrons
     -

Created on: 2015-04-14 16:33:52
Modified on: 2018-10-02 15:27:09
Date last run: -

----------

Public: 0
Expiry: 0

----------

Returns borrowers at your library with just fines still owed (or no fines) and no checkouts, who have been expired since before a specified date. The companion report that is specific to Leavenworth is 2395.

<p><span style="background-color: darkred; color: white">Scheduled for deletion on November 30, 2018</p>

----------

SELECT b.borrowernumber as "borrower", CONCAT ('<a href=\"/cgi-bin/koha/members/boraccount.pl?borrowernumber=',b.borrowernumber,'\" target="_blank">',b.cardnumber,'</a>') AS "Link to Fines", FORMAT(sum(a.amountoutstanding), 2) as "owed" 
FROM borrowers b LEFT JOIN accountlines a USING(borrowernumber) 
WHERE b.dateexpiry < <<enter date in yyyy-mm-dd format for latest expiration date>> AND b.branchcode=<<choose branch|branches>> AND (b.borrowernumber NOT IN 
(SELECT b.borrowernumber FROM accountlines a LEFT JOIN borrowers b USING(borrowernumber) WHERE b.branchcode=<<choose branch|branches>> AND a.accounttype IN ('L','LOSTI','Damag','A','Copie','M','N') AND a.amountoutstanding > '0') 
OR b.borrowernumber NOT IN (SELECT borrowernumber FROM accountlines))  
AND b.borrowernumber NOT IN (SELECT borrowernumber FROM issues) 
GROUP BY b.borrowernumber HAVING sum(a.amountoutstanding) >= '0'
UNION ALL
SELECT b.borrowernumber as "borrower", CONCAT ('<a href=\"/cgi-bin/koha/members/boraccount.pl?borrowernumber=',b.borrowernumber,'\" target="_blank">',b.cardnumber,'</a>') AS "Link to Fines", '0.00' as "owed" 
FROM borrowers b WHERE b.branchcode=<<choose branch|branches>> AND b.dateexpiry < <<enter date in yyyy-mm-dd format for latest expiration date>> AND b.borrowernumber NOT IN 
(SELECT borrowernumber FROM issues) 
AND borrowernumber NOT IN (SELECT borrowernumber FROM accountlines)
ORDER BY CAST(owed AS DECIMAL(10,2)) DESC



